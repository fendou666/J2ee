<%@page import="java.util.ArrayList"%>
<%@page import="java.util.List"%>
<%@page import="org.apache.catalina.connector.Request"%>
<%@page import="com.study.jspJava.Message"%>
<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Insert title here</title>
</head>
<body>
	<%!
		//List<Message> msgList = (List<Message>)getServletContext().getAttribute("msgInfo");
		List<Message> msgList = null; 
		public synchronized boolean addMsg(Message msg){
			boolean ret = false;
			ServletContext sc = getServletContext();
			List<Message> msgList = (List<Message>)sc.getAttribute("msgInfo");
			if(msgList==null){
				msgList = new ArrayList<Message>();
			}
			msgList.add(msg);
			sc.setAttribute("msgInfo", msgList);
			ret = true;
			return ret;
		}
	%>
	<%
		String title 	= 	request.getParameter("title");
		String name 	= 	request.getParameter("name");
		String content 	= 	request.getParameter("content");
		String date 	= 	request.getParameter("date");
		if(title==null || name==null || content==null || date==null){
			
		}
		
		Message msg = new Message(title, name, content, date);
		if(addMsg(msg)){
			request.setAttribute("reqRst", "请求成功");
			response.sendRedirect("SetMsg.jsp");
		}else{
			request.setAttribute("reqRst", "请求失败");
			request.getRequestDispatcher("SetMsg.jsp").forward(request, response);
		}
	%>
</body>
</html>